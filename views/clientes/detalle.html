{{extend 'layout.html'}}

{{block head}}
<style>
:root {
    --color-fondo: #000000;
    --color-menu: #FF8C00;
    --color-acento: #FFD700;
    --color-texto: #FFFFFF;
    --color-texto-secundario: #CCCCCC;
}

body {
    background-color: var(--color-fondo);
    color: var(--color-texto);
}

.card {
    background-color: #1a1a1a;
    border: 1px solid #333;
    color: var(--color-texto);
}

.card-header {
    background-color: var(--color-menu);
    color: #000;
    font-weight: bold;
}

.table-dark {
    background-color: #1a1a1a;
    color: var(--color-texto);
}

.table-dark th {
    background-color: var(--color-menu);
    color: #000;
    border-color: #333;
    font-weight: bold;
}

.table-dark td {
    border-color: #333;
    vertical-align: middle;
}

.table-dark tbody tr:hover {
    background-color: #2a2a2a;
}

.badge-success {
    background-color: #28a745;
}

.badge-warning {
    background-color: #ffc107;
    color: #000;
}

.badge-danger {
    background-color: #dc3545;
}

.badge-info {
    background-color: #17a2b8;
}

.badge-secondary {
    background-color: #6c757d;
}

.info-section {
    background-color: #2a2a2a;
    border-radius: 0.375rem;
    padding: 1.5rem;
    margin-bottom: 1rem;
}

.info-label {
    font-weight: bold;
    color: var(--color-acento);
    margin-bottom: 0.5rem;
}

.info-value {
    color: var(--color-texto);
    font-size: 1.1rem;
}

.saldo-card {
    background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
    border: 1px solid #333;
    border-radius: 0.5rem;
    padding: 1.5rem;
    text-align: center;
    margin-bottom: 1rem;
}

.saldo-moneda {
    font-size: 0.9rem;
    color: var(--color-texto-secundario);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.saldo-monto {
    font-size: 1.8rem;
    font-weight: bold;
    color: var(--color-acento);
    margin: 0.5rem 0;
}

.btn-primary {
    background-color: var(--color-menu);
    border-color: var(--color-menu);
    color: #000;
    font-weight: bold;
}

.btn-primary:hover {
    background-color: var(--color-acento);
    border-color: var(--color-acento);
    color: #000;
}

.btn-secondary {
    background-color: #555;
    border-color: #555;
    color: var(--color-texto);
}

.btn-secondary:hover {
    background-color: #666;
    border-color: #666;
}

.btn-warning {
    background-color: #ffc107;
    border-color: #ffc107;
    color: #000;
}

.btn-warning:hover {
    background-color: #e0a800;
    border-color: #d39e00;
    color: #000;
}

.btn-success {
    background-color: #28a745;
    border-color: #28a745;
}

.btn-success:hover {
    background-color: #218838;
    border-color: #1e7e34;
}

.btn-danger {
    background-color: #dc3545;
    border-color: #dc3545;
}

.btn-danger:hover {
    background-color: #c82333;
    border-color: #bd2130;
}

.transaction-type-compra {
    color: #28a745;
}

.transaction-type-venta {
    color: #dc3545;
}

.no-transactions {
    text-align: center;
    padding: 3rem;
    color: var(--color-texto-secundario);
}
</style>
{{end}}

<div class="row">
    <!-- Información Personal -->
    <div class="col-md-4">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fa fa-user"></i> Información Personal
                </h5>
            </div>
            <div class="card-body">
                <div class="info-section">
                    <div class="info-label">Nombre Completo</div>
                    <div class="info-value">{{=cliente.auth_user.first_name}} {{=cliente.auth_user.last_name}}</div>
                </div>
                
                <div class="info-section">
                    <div class="info-label">Cédula de Identidad</div>
                    <div class="info-value">{{=cliente.clientes.cedula}}</div>
                </div>
                
                <div class="info-section">
                    <div class="info-label">Correo Electrónico</div>
                    <div class="info-value">
                        <a href="mailto:{{=cliente.auth_user.email}}" class="text-info">
                            {{=cliente.auth_user.email}}
                        </a>
                    </div>
                </div>
                
                <div class="info-section">
                    <div class="info-label">Teléfono</div>
                    <div class="info-value">{{=cliente.auth_user.telefono}}</div>
                </div>
                
                <div class="info-section">
                    <div class="info-label">Dirección</div>
                    <div class="info-value">{{=cliente.auth_user.direccion}}</div>
                </div>
                
                <div class="info-section">
                    <div class="info-label">Fecha de Nacimiento</div>
                    <div class="info-value">{{=cliente.auth_user.fecha_nacimiento.strftime('%d/%m/%Y')}}</div>
                </div>
                
                <div class="info-section">
                    <div class="info-label">Estado</div>
                    <div class="info-value">
                        {{if cliente.auth_user.estado == 'activo':}}
                            <span class="badge badge-success badge-lg">Activo</span>
                        {{else:}}
                            <span class="badge badge-danger badge-lg">Inactivo</span>
                        {{pass}}
                    </div>
                </div>
                
                <div class="info-section">
                    <div class="info-label">Fecha de Registro</div>
                    <div class="info-value">{{=cliente.clientes.fecha_registro.strftime('%d/%m/%Y %H:%M')}}</div>
                </div>
            </div>
        </div>
        
        <!-- Acciones -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fa fa-cogs"></i> Acciones
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{=URL('clientes', 'perfil', args=[cliente.clientes.id])}}" 
                       class="btn btn-warning btn-block">
                        <i class="fa fa-edit"></i> Editar Perfil
                    </a>
                    
                    {{if auth.has_membership('administrador'):}}
                        {{if cliente.auth_user.estado == 'activo':}}
                        <a href="{{=URL('clientes', 'cambiar_estado', args=[cliente.clientes.id, 'inactivo'])}}" 
                           class="btn btn-danger btn-block"
                           onclick="return confirm('¿Está seguro de desactivar este cliente?')">
                            <i class="fa fa-ban"></i> Desactivar Cliente
                        </a>
                        {{else:}}
                        <a href="{{=URL('clientes', 'cambiar_estado', args=[cliente.clientes.id, 'activo'])}}" 
                           class="btn btn-success btn-block"
                           onclick="return confirm('¿Está seguro de activar este cliente?')">
                            <i class="fa fa-check"></i> Activar Cliente
                        </a>
                        {{pass}}
                    {{pass}}
                    
                    <a href="{{=URL('clientes', 'listar')}}" class="btn btn-secondary btn-block">
                        <i class="fa fa-arrow-left"></i> Volver a Lista
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Cuentas y Transacciones -->
    <div class="col-md-8">
        <!-- Cuentas Bancarias -->
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fa fa-credit-card"></i> Cuentas Bancarias
                    <span class="badge badge-secondary ml-2">{{=len(cuentas)}}</span>
                </h5>
            </div>
            <div class="card-body">
                {{if cuentas:}}
                    {{for cuenta in cuentas:}}
                    <div class="row mb-4">
                        <div class="col-12">
                            <h6>
                                <strong>{{=cuenta.numero_cuenta}}</strong>
                                <span class="float-right">
                                    {{if cuenta.estado == 'activa':}}
                                        <span class="badge badge-success">{{=cuenta.estado.title()}}</span>
                                    {{elif cuenta.estado == 'inactiva':}}
                                        <span class="badge badge-warning">{{=cuenta.estado.title()}}</span>
                                    {{else:}}
                                        <span class="badge badge-danger">{{=cuenta.estado.title()}}</span>
                                    {{pass}}
                                </span>
                            </h6>
                            <small class="text-muted">
                                Tipo: {{=cuenta.tipo_cuenta.title()}} | 
                                Creada: {{=cuenta.fecha_creacion.strftime('%d/%m/%Y')}}
                            </small>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="saldo-card">
                                <div class="saldo-moneda">Bolívares (VES)</div>
                                <div class="saldo-monto">{{="{:,.2f}".format(float(cuenta.saldo_ves))}}</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="saldo-card">
                                <div class="saldo-moneda">Dólares (USD)</div>
                                <div class="saldo-monto">{{="{:,.2f}".format(float(cuenta.saldo_usd))}}</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="saldo-card">
                                <div class="saldo-moneda">Euros (EUR)</div>
                                <div class="saldo-monto">{{="{:,.2f}".format(float(cuenta.saldo_eur))}}</div>
                            </div>
                        </div>
                    </div>
                    
                    {{if not loop.last:}}
                    <hr class="my-4">
                    {{pass}}
                    {{pass}}
                {{else:}}
                <div class="text-center py-4">
                    <i class="fa fa-credit-card fa-3x text-muted mb-3"></i>
                    <h6 class="text-muted">No hay cuentas registradas</h6>
                    <p class="text-muted">Este cliente no tiene cuentas bancarias asociadas</p>
                </div>
                {{pass}}
            </div>
        </div>
        
        <!-- Últimas Transacciones -->
        <div class="card mt-3">
            <div class="card-header">
                <h5 class="mb-0">
                    <i class="fa fa-exchange"></i> Últimas Transacciones
                    <span class="badge badge-secondary ml-2">{{=len(ultimas_transacciones)}}</span>
                </h5>
            </div>
            <div class="card-body p-0">
                {{if ultimas_transacciones:}}
                <div class="table-responsive">
                    <table class="table table-dark table-striped mb-0">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Monedas</th>
                                <th>Monto</th>
                                <th>Tasa</th>
                                <th>Estado</th>
                                <th>Comprobante</th>
                            </tr>
                        </thead>
                        <tbody>
                            {{for transaccion in ultimas_transacciones:}}
                            <tr>
                                <td>{{=transaccion.fecha_transaccion.strftime('%d/%m/%Y %H:%M')}}</td>
                                <td>
                                    {{if transaccion.tipo_operacion == 'compra':}}
                                        <span class="transaction-type-compra">
                                            <i class="fa fa-arrow-up"></i> Compra
                                        </span>
                                    {{else:}}
                                        <span class="transaction-type-venta">
                                            <i class="fa fa-arrow-down"></i> Venta
                                        </span>
                                    {{pass}}
                                </td>
                                <td>
                                    <small>
                                        {{=transaccion.moneda_origen}} → {{=transaccion.moneda_destino}}
                                    </small>
                                </td>
                                <td>
                                    <strong>{{="{:,.2f}".format(float(transaccion.monto_origen))}}</strong>
                                    <small class="text-muted">{{=transaccion.moneda_origen}}</small>
                                    <br>
                                    <small>
                                        {{="{:,.2f}".format(float(transaccion.monto_destino))}} {{=transaccion.moneda_destino}}
                                    </small>
                                </td>
                                <td>
                                    <small>{{="{:,.4f}".format(float(transaccion.tasa_aplicada))}}</small>
                                </td>
                                <td>
                                    {{if transaccion.estado == 'completada':}}
                                        <span class="badge badge-success">Completada</span>
                                    {{elif transaccion.estado == 'pendiente':}}
                                        <span class="badge badge-warning">Pendiente</span>
                                    {{elif transaccion.estado == 'cancelada':}}
                                        <span class="badge badge-secondary">Cancelada</span>
                                    {{else:}}
                                        <span class="badge badge-danger">Fallida</span>
                                    {{pass}}
                                </td>
                                <td>
                                    <small class="text-muted">{{=transaccion.numero_comprobante}}</small>
                                </td>
                            </tr>
                            {{pass}}
                        </tbody>
                    </table>
                </div>
                {{else:}}
                <div class="no-transactions">
                    <i class="fa fa-exchange fa-3x mb-3"></i>
                    <h6>No hay transacciones registradas</h6>
                    <p>Este cliente no ha realizado transacciones de divisas</p>
                </div>
                {{pass}}
            </div>
        </div>
    </div>
</div>