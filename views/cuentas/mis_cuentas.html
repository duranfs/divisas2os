{{extend 'layout.html'}}

<div class="container-fluid">
    <!-- Header de la página -->
    <div class="page-header fade-in-up">
        <div class="row align-items-center">
            <div class="col-12">
                <h1>
                    <i class="fas fa-university me-3"></i>Mis Cuentas Bancarias
                </h1>
                <p class="lead mb-0">Consulta y gestión de tus cuentas y saldos</p>
            </div>
        </div>
    </div>

    {{if response.flash:}}
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert alert-info alert-dismissible fade show">
                {{=response.flash}}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        </div>
    </div>
    {{pass}}

    {{if cliente and cuentas:}}
    <!-- Resumen de saldos -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center bg-light border-success">
                <div class="card-body">
                    <i class="fas fa-coins fa-3x text-success mb-3"></i>
                    <h4 class="text-success">{{="{:,.2f}".format(float(total_ves or 0))}}</h4>
                    <h6 class="text-muted">Bolívares (VES)</h6>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-light border-primary">
                <div class="card-body">
                    <i class="fas fa-dollar-sign fa-3x text-primary mb-3"></i>
                    <h4 class="text-primary">{{="{:,.2f}".format(float(total_usd or 0))}}</h4>
                    <h6 class="text-muted">Dólares (USD)</h6>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-light border-warning">
                <div class="card-body">
                    <i class="fas fa-euro-sign fa-3x text-warning mb-3"></i>
                    <h4 class="text-warning">{{="{:,.2f}".format(float(total_eur or 0))}}</h4>
                    <h6 class="text-muted">Euros (EUR)</h6>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center bg-light border-info">
                <div class="card-body">
                    <i class="fas fa-coins fa-3x text-info mb-3"></i>
                    <h4 class="text-info">{{="{:,.2f}".format(float(total_usdt or 0))}}</h4>
                    <h6 class="text-muted">Tether (USDT)</h6>
                </div>
            </div>
        </div>
    </div>

    <!-- Lista de cuentas -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-secondary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-list me-2"></i>Mis Cuentas Bancarias
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Número de Cuenta</th>
                                    <th>Tipo</th>
                                    <th>Estado</th>
                                    <th class="text-end">VES</th>
                                    <th class="text-end">USD</th>
                                    <th class="text-end">EUR</th>
                                    <th class="text-end">USDT</th>
                                    <th class="text-center">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                {{for cuenta in cuentas:}}
                                <tr>
                                    <td>
                                        <code>{{=cuenta.numero_cuenta}}</code>
                                    </td>
                                    <td>
                                        <span class="badge bg-info">{{=cuenta.tipo_cuenta.title() if cuenta.tipo_cuenta else 'N/A'}}</span>
                                    </td>
                                    <td>
                                        {{if cuenta.estado == 'activa':}}
                                            <span class="badge bg-success">Activa</span>
                                        {{else:}}
                                            <span class="badge bg-secondary">{{=cuenta.estado.title() if cuenta.estado else 'N/A'}}</span>
                                        {{pass}}
                                    </td>
                                    <td class="text-end">
                                        <strong>{{="{:,.2f}".format(float(cuenta.saldo_ves or 0))}}</strong>
                                    </td>
                                    <td class="text-end">
                                        <strong>{{="{:,.2f}".format(float(cuenta.saldo_usd or 0))}}</strong>
                                    </td>
                                    <td class="text-end">
                                        <strong>{{="{:,.2f}".format(float(cuenta.saldo_eur or 0))}}</strong>
                                    </td>
                                    <td class="text-end">
                                        <strong>{{="{:,.2f}".format(float(cuenta.saldo_usdt or 0))}}</strong>
                                    </td>
                                    <td class="text-center">
                                        <a href="{{=URL('cuentas', 'detalle', args=[cuenta.id])}}" 
                                           class="btn btn-sm btn-outline-primary">
                                            Ver Detalles
                                        </a>
                                    </td>
                                </tr>
                                {{pass}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {{elif cliente and not cuentas:}}
    <!-- Cliente sin cuentas -->
    <div class="row">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0">Sin Cuentas Bancarias</h5>
                </div>
                <div class="card-body text-center py-5">
                    <i class="fas fa-university fa-5x text-warning mb-4"></i>
                    <h4 class="text-warning mb-3">No tienes cuentas bancarias</h4>
                    <p class="text-muted mb-4">Contacta con un administrador para crear tu primera cuenta.</p>
                </div>
            </div>
        </div>
    </div>

    {{else:}}
    <!-- Error: Cliente no encontrado -->
    <div class="row">
        <div class="col-12">
            <div class="card border-danger">
                <div class="card-header bg-danger text-white">
                    <h5 class="mb-0">Error de Acceso</h5>
                </div>
                <div class="card-body text-center py-5">
                    <i class="fas fa-user-times fa-5x text-danger mb-4"></i>
                    <h4 class="text-danger mb-3">Perfil de Cliente No Encontrado</h4>
                    <p class="text-muted mb-4">No se pudo cargar tu información de cliente.</p>
                    <a href="{{=URL('clientes', 'registrar')}}" class="btn btn-primary">
                        Completar Registro
                    </a>
                </div>
            </div>
        </div>
    </div>
    {{pass}}
</div>