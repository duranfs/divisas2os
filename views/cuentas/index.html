{{extend 'layout.html'}}

<div class="container-fluid">
    <!-- Header -->
    <div class="page-header">
        <h1><i class="fas fa-university me-3"></i>Mis Cuentas y Saldos</h1>
        <p class="lead">Gestiona tus cuentas bancarias y consulta tus saldos</p>
    </div>

    <!-- Breadcrumbs -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{=URL('default', 'dashboard')}}">Inicio</a></li>
            <li class="breadcrumb-item active">Cuentas</li>
        </ol>
    </nav>

    <!-- Flash Messages -->
    {{if response.flash:}}
    <div class="alert alert-info alert-dismissible fade show">
        {{=response.flash}}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {{pass}}

    <!-- Resumen de Saldos -->
    {{if cuentas:}}
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="text-muted">Total Cuentas</h6>
                    <h3>{{=stats.get('total_cuentas', 0)}}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="text-muted">Cuentas Activas</h6>
                    <h3 class="text-success">{{=stats.get('cuentas_activas', 0)}}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="text-muted">VES</h6>
                    <h3>Bs. {{="{:,.2f}".format(float(total_ves or 0))}}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h6 class="text-muted">USD</h6>
                    <h3>$ {{="{:,.2f}".format(float(total_usd or 0))}}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Lista de Cuentas por Moneda -->
    {{if cuentas_por_moneda:}}
        <!-- Cuentas VES -->
        {{if cuentas_por_moneda.get('VES'):}}
        <div class="row mb-4">
            <div class="col-12">
                <h4 class="mb-3">
                    <i class="fas fa-coins text-warning me-2"></i>
                    Cuentas en Bolívares (VES)
                    <span class="badge bg-warning ms-2">{{=len(cuentas_por_moneda['VES'])}} cuenta(s)</span>
                </h4>
            </div>
            {{for cuenta in cuentas_por_moneda['VES']:}}
            <div class="col-md-6 mb-3">
                <div class="card border-warning">
                    <div class="card-header bg-warning bg-opacity-10">
                        <h6 class="mb-0">
                            <i class="fas fa-credit-card me-2"></i>
                            Cuenta {{=cuenta.tipo_cuenta.title()}}
                            <span class="badge bg-{{='success' if cuenta.estado == 'activa' else 'danger'}} ms-2">
                                {{=cuenta.estado.title()}}
                            </span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <p><strong>Número:</strong> <code>{{=cuenta.numero_cuenta}}</code></p>
                        <div class="text-center py-3 bg-light rounded">
                            <small class="text-muted">Saldo Disponible</small>
                            <h2 class="text-warning mb-0">Bs. {{="{:,.2f}".format(float(cuenta.saldo or 0))}}</h2>
                        </div>
                        <div class="mt-3">
                            <a href="{{=URL('cuentas', 'detalle', args=[cuenta.id])}}" class="btn btn-outline-warning btn-sm">
                                <i class="fas fa-eye"></i> Ver Detalle
                            </a>
                            <a href="{{=URL('cuentas', 'movimientos', args=[cuenta.id])}}" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-list"></i> Movimientos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {{pass}}
        </div>
        {{pass}}

        <!-- Cuentas USD -->
        {{if cuentas_por_moneda.get('USD'):}}
        <div class="row mb-4">
            <div class="col-12">
                <h4 class="mb-3">
                    <i class="fas fa-dollar-sign text-success me-2"></i>
                    Cuentas en Dólares (USD)
                    <span class="badge bg-success ms-2">{{=len(cuentas_por_moneda['USD'])}} cuenta(s)</span>
                </h4>
            </div>
            {{for cuenta in cuentas_por_moneda['USD']:}}
            <div class="col-md-6 mb-3">
                <div class="card border-success">
                    <div class="card-header bg-success bg-opacity-10">
                        <h6 class="mb-0">
                            <i class="fas fa-credit-card me-2"></i>
                            Cuenta {{=cuenta.tipo_cuenta.title()}}
                            <span class="badge bg-{{='success' if cuenta.estado == 'activa' else 'danger'}} ms-2">
                                {{=cuenta.estado.title()}}
                            </span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <p><strong>Número:</strong> <code>{{=cuenta.numero_cuenta}}</code></p>
                        <div class="text-center py-3 bg-light rounded">
                            <small class="text-muted">Saldo Disponible</small>
                            <h2 class="text-success mb-0">$ {{="{:,.2f}".format(float(cuenta.saldo or 0))}}</h2>
                        </div>
                        <div class="mt-3">
                            <a href="{{=URL('cuentas', 'detalle', args=[cuenta.id])}}" class="btn btn-outline-success btn-sm">
                                <i class="fas fa-eye"></i> Ver Detalle
                            </a>
                            <a href="{{=URL('cuentas', 'movimientos', args=[cuenta.id])}}" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-list"></i> Movimientos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {{pass}}
        </div>
        {{pass}}

        <!-- Cuentas EUR -->
        {{if cuentas_por_moneda.get('EUR'):}}
        <div class="row mb-4">
            <div class="col-12">
                <h4 class="mb-3">
                    <i class="fas fa-euro-sign text-info me-2"></i>
                    Cuentas en Euros (EUR)
                    <span class="badge bg-info ms-2">{{=len(cuentas_por_moneda['EUR'])}} cuenta(s)</span>
                </h4>
            </div>
            {{for cuenta in cuentas_por_moneda['EUR']:}}
            <div class="col-md-6 mb-3">
                <div class="card border-info">
                    <div class="card-header bg-info bg-opacity-10">
                        <h6 class="mb-0">
                            <i class="fas fa-credit-card me-2"></i>
                            Cuenta {{=cuenta.tipo_cuenta.title()}}
                            <span class="badge bg-{{='success' if cuenta.estado == 'activa' else 'danger'}} ms-2">
                                {{=cuenta.estado.title()}}
                            </span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <p><strong>Número:</strong> <code>{{=cuenta.numero_cuenta}}</code></p>
                        <div class="text-center py-3 bg-light rounded">
                            <small class="text-muted">Saldo Disponible</small>
                            <h2 class="text-info mb-0">€ {{="{:,.2f}".format(float(cuenta.saldo or 0))}}</h2>
                        </div>
                        <div class="mt-3">
                            <a href="{{=URL('cuentas', 'detalle', args=[cuenta.id])}}" class="btn btn-outline-info btn-sm">
                                <i class="fas fa-eye"></i> Ver Detalle
                            </a>
                            <a href="{{=URL('cuentas', 'movimientos', args=[cuenta.id])}}" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-list"></i> Movimientos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {{pass}}
        </div>
        {{pass}}

        <!-- Cuentas USDT -->
        {{if cuentas_por_moneda.get('USDT'):}}
        <div class="row mb-4">
            <div class="col-12">
                <h4 class="mb-3">
                    <i class="fab fa-bitcoin text-primary me-2"></i>
                    Cuentas en Tether (USDT)
                    <span class="badge bg-primary ms-2">{{=len(cuentas_por_moneda['USDT'])}} cuenta(s)</span>
                </h4>
            </div>
            {{for cuenta in cuentas_por_moneda['USDT']:}}
            <div class="col-md-6 mb-3">
                <div class="card border-primary">
                    <div class="card-header bg-primary bg-opacity-10">
                        <h6 class="mb-0">
                            <i class="fas fa-credit-card me-2"></i>
                            Cuenta {{=cuenta.tipo_cuenta.title()}}
                            <span class="badge bg-{{='success' if cuenta.estado == 'activa' else 'danger'}} ms-2">
                                {{=cuenta.estado.title()}}
                            </span>
                        </h6>
                    </div>
                    <div class="card-body">
                        <p><strong>Número:</strong> <code>{{=cuenta.numero_cuenta}}</code></p>
                        <div class="text-center py-3 bg-light rounded">
                            <small class="text-muted">Saldo Disponible</small>
                            <h2 class="text-primary mb-0">₮ {{="{:,.2f}".format(float(cuenta.saldo or 0))}}</h2>
                        </div>
                        <div class="mt-3">
                            <a href="{{=URL('cuentas', 'detalle', args=[cuenta.id])}}" class="btn btn-outline-primary btn-sm">
                                <i class="fas fa-eye"></i> Ver Detalle
                            </a>
                            <a href="{{=URL('cuentas', 'movimientos', args=[cuenta.id])}}" class="btn btn-outline-secondary btn-sm">
                                <i class="fas fa-list"></i> Movimientos
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            {{pass}}
        </div>
        {{pass}}
    {{pass}}

    {{else:}}
    <!-- No hay cuentas -->
    <div class="row">
        <div class="col-12">
            <div class="card text-center">
                <div class="card-body py-5">
                    <i class="fas fa-university fa-4x text-muted mb-3"></i>
                    <h4 class="text-muted">No tienes cuentas registradas</h4>
                    <p class="text-muted mb-4">
                        Para comenzar a operar con divisas, necesitas crear al menos una cuenta bancaria.
                    </p>
                    <a href="{{=URL('cuentas', 'crear')}}" class="btn btn-success btn-lg">
                        <i class="fas fa-plus me-2"></i>Crear Mi Primera Cuenta
                    </a>
                </div>
            </div>
        </div>
    </div>
    {{pass}}
</div>
