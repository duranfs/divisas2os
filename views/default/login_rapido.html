{{extend 'layout.html'}}

<div class="container">
    <div class="row">
        <div class="col-md-10 offset-md-1">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h4><i class="fa fa-bolt"></i> Login Rápido - Todos los Usuarios</h4>
                    <small>Haz clic en cualquier usuario para hacer login automáticamente</small>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h5>🚀 Acceso Directo al Sistema</h5>
                        <p>Esta página te permite hacer login como cualquier usuario sin usar el formulario problemático.</p>
                    </div>
                    
                    <div class="row">
                        {{for usuario in usuarios:}}
                        <div class="col-md-6 mb-3">
                            <div class="card border-{{='success' if 'administrador' in usuario['roles'] else 'primary' if 'cliente' in usuario['roles'] else 'secondary'}}">
                                <div class="card-header bg-{{='success' if 'administrador' in usuario['roles'] else 'primary' if 'cliente' in usuario['roles'] else 'secondary'}} text-white">
                                    <h6 class="mb-0">
                                        <i class="fa fa-{{='crown' if 'administrador' in usuario['roles'] else 'user' if 'cliente' in usuario['roles'] else 'question'}}"></i>
                                        {{=', '.join(usuario['roles']) if usuario['roles'] else 'Sin rol'}}
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <h5 class="card-title">{{=usuario['nombre']}}</h5>
                                    <p class="card-text">
                                        <strong>Email:</strong> {{=usuario['email']}}<br>
                                        <strong>Estado:</strong> 
                                        <span class="badge badge-{{='success' if usuario['estado'] == 'activo' else 'danger'}}">
                                            {{=usuario['estado'] or 'N/A'}}
                                        </span>
                                    </p>
                                    
                                    {{if usuario['estado'] == 'activo':}}
                                    <a href="{{=URL('default', 'login_como', args=[usuario['id']])}}" 
                                       class="btn btn-{{='success' if 'administrador' in usuario['roles'] else 'primary' if 'cliente' in usuario['roles'] else 'secondary'}} btn-block"
                                       onclick="return confirm('¿Hacer login como este usuario?')"
                                        <i class="fa fa-sign-in-alt"></i> Login como este usuario
                                    </a>
                                    {{else:}}
                                    <button class="btn btn-secondary btn-block" disabled>
                                        <i class="fa fa-ban"></i> Usuario inactivo
                                    </button>
                                    {{pass}}
                                </div>
                            </div>
                        </div>
                        {{pass}}
                    </div>
                    
                    <hr>
                    
                    <div class="text-center">
                        <h5>🔧 Otras opciones:</h5>
                        <a href="{{=URL('default', 'user/login')}}" class="btn btn-warning btn-lg">
                            <i class="fa fa-sign-in-alt"></i> Formulario de Login Normal
                        </a>
                        <a href="{{=URL('default', 'diagnosticar_login')}}" class="btn btn-info btn-lg ml-2">
                            <i class="fa fa-stethoscope"></i> Diagnóstico
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.card {
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
}

.badge {
    font-size: 0.8em;
}
</style>