{{extend 'layout.html'}}

<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h3 class="card-title mb-0">
            {{if request.args(0) == 'register':}}
              <i class="fas fa-user-plus"></i> Registro de Usuario
            {{elif request.args(0) == 'login':}}
              <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
            {{else:}}
              {{=T(request.args(0).replace('_',' ').title())}}
            {{pass}}
          </h3>
        </div>
        
        <div class="card-body">
          {{if request.args(0) == 'register':}}
          <div class="alert alert-info">
            <i class="fas fa-info-circle"></i>
            <strong>Bienvenido al Sistema de Divisas Bancario</strong><br>
            Complete todos los campos para crear su cuenta. Todos los campos son obligatorios.
          </div>
          {{pass}}
          
          {{if response.flash:}}
          <div class="alert alert-warning alert-dismissible fade show">
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            {{=response.flash}}
          </div>
          {{pass}}
          
          {{if request.args(0) == 'register':}}
            <!-- Formulario de registro personalizado con etiquetas negras -->
            <style>
              .registro-form .form-label {
                color: #000000 !important;
                font-weight: 600 !important;
                display: block !important;
                margin-bottom: 0.5rem !important;
              }
              .registro-form .form-text {
                color: #6c757d !important;
                font-size: 0.875rem !important;
              }
            </style>
            
            <div class="registro-form">
              {{=form}}
            </div>
          {{else:}}
            <!-- Otros formularios (login, etc.) -->
            {{=form}}
          {{pass}}
          
          <div class="mt-3">
            {{if request.args(0)=='login' and not 'register' in auth.settings.actions_disabled:}}
            <p class="text-center">
              ¿No tiene cuenta? 
              <a href="{{=URL('user/register')}}" class="btn btn-outline-primary btn-sm">
                <i class="fas fa-user-plus"></i> Registrarse
              </a>
            </p>
            {{pass}}
            
            {{if request.args(0)=='login' and not 'retrieve_password' in auth.settings.actions_disabled:}}
            <p class="text-center">
              <a href="{{=URL('user/retrieve_password')}}" class="text-muted">
                <i class="fas fa-key"></i> ¿Olvidó su contraseña?
              </a>
            </p>
            {{pass}}
            
            {{if request.args(0)=='register':}}
            <p class="text-center">
              ¿Ya tiene cuenta? 
              <a href="{{=URL('user/login')}}" class="btn btn-outline-success btn-sm">
                <i class="fas fa-sign-in-alt"></i> Iniciar Sesión
              </a>
            </p>
            {{pass}}
          </div>
        </div>
        
        {{if request.args(0) == 'register':}}
        <div class="card-footer text-muted">
          <small>
            <i class="fas fa-shield-alt"></i>
            Sus datos están protegidos y serán utilizados únicamente para la gestión de su cuenta bancaria.
          </small>
        </div>
        {{pass}}
      </div>
    </div>
  </div>
</div>



{{block page_js}}
<script>
jQuery(document).ready(function() {
    // Enfocar el primer campo visible
    jQuery("#web2py_user_form input:visible:enabled:first").focus();
    
    // Mejorar la presentación de los formularios
    jQuery('.web2py_form input, .web2py_form textarea, .web2py_form select').addClass('form-control');
    jQuery('.web2py_form label').addClass('form-label');
    
    // Validación de contraseña según el tipo de página
    var pageType = '{{=request.args(0) if request.args else ""}}';
    if (pageType === 'register') {
        // Asegurar que las etiquetas sean negras en el registro
        jQuery('.registro-form label, .registro-form .w2p_fl, .web2py_form label, .web2py_form .w2p_fl').each(function() {
            jQuery(this).css({
                'color': '#000000',
                'font-weight': '600',
                'display': 'block'
            }).attr('style', jQuery(this).attr('style') + '; color: #000000 !important;');
        });
        
        // Forzar el color cada 100ms por si acaso
        setTimeout(function() {
            jQuery('.registro-form label, .registro-form .w2p_fl, .web2py_form label, .web2py_form .w2p_fl').css('color', '#000000');
        }, 100);
        
        // Validación de entropía
        if (typeof web2py_validate_entropy !== 'undefined') {
            web2py_validate_entropy(jQuery('#auth_user_password'), 100);
        }
    } else if (pageType === 'change_password' && typeof web2py_validate_entropy !== 'undefined') {
        web2py_validate_entropy(jQuery('#no_table_new_password'), 100);
    }
});
</script>
{{end page_js}}
